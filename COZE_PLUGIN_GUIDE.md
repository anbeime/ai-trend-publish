# TrendPublish Coze 插件创建指南

## 🚀 快速开始

### 第一步：导入 OpenAPI 配置文件

1. **登录 Coze 平台**
   - 访问 [Coze 官网](https://coze.com)
   - 使用你的账号登录

2. **创建新插件**
   - 点击左侧导航「插件」
   - 点击「创建插件」
   - 选择「自定义插件」

3. **导入 OpenAPI 配置**
   - 在插件创建页面，找到「导入配置文件」选项
   - 选择「文件上传」或「粘贴文本」
   - 上传项目根目录下的 `coze-wechat-openapi.json` 文件
   - 或者直接复制文件内容粘贴到文本框

4. **确认插件信息**
   - 插件名称：`微信文章发布助手`
   - 插件描述：`一键发布文章到微信公众号草稿箱`
   - 基础URL：留空（自动从 OpenAPI 文件读取）
   - 分类：工具→内容发布

5. **点击「保存基础信息」**

### 第二步：配置插件基础信息

| 配置项 | 建议填写内容 |
|-------|-------------|
| 插件名称 | 微信文章发布助手 |
| 插件描述 | 一键发布文章到微信公众号草稿箱 |
| 基础URL | 留空（自动读取） |
| 图标 | 上传微信相关图标 |
| 分类 | 工具→内容发布 |
| 标签 | 微信、公众号、内容发布 |

### 第三步：测试插件功能

#### 1. 获取 Access Token 测试
- 接口：`getAccessToken`
- 参数：
  - `grant_type`: `client_credential`
  - `appid`: 你的微信公众号 AppID
  - `secret`: 你的微信公众号 AppSecret
- 预期结果：返回 `access_token` 和 `expires_in`

#### 2. 上传图片测试
- 接口：`uploadImage`
- 参数：
  - `access_token`: 从上一步获取
  - `type`: `image`
  - `media`: 选择一张测试图片（≤2MB）
- 预期结果：返回 `media_id`

#### 3. 创建草稿测试
- 接口：`createDraft`
- 参数：
  - `access_token`: Access Token
  - `articles`: 文章数组（JSON格式）
- 预期结果：返回草稿 `media_id`

#### 4. 发布文章测试（可选）
- 接口：`publishDraft`
- 参数：
  - `access_token`: Access Token
  - `media_id`: 从创建草稿获取的 media_id
- 预期结果：返回 `publish_id`

### 第四步：发布为 MCP 模板

1. **保存插件配置**
   - 确保所有接口测试通过
   - 点击「保存」保存插件配置

2. **发布插件**
   - 返回插件详情页
   - 点击右上角「发布」
   - 选择发布范围：
     - `仅自己/团队可见`：测试阶段
     - `公开`：正式发布

3. **发布为 MCP**
   - 在插件列表中找到你的插件
   - 点击卡片右上角「···」
   - 选择「发布为 MCP」
   - 填写 MCP 信息：
     - MCP 名称：`微信公众号文章一键发布`
     - MCP 描述：`无需编程，输入标题、内容、封面即可自动发布到微信公众号`
     - 标签：`微信、公众号、内容发布`
     - 隐私：选择 `私有` 或 `公开`
   - 提交发布

## 🔧 微信公众号准备工作

### 1. 获取微信公众号信息
- 登录 [微信公众平台](https://mp.weixin.qq.com)
- 进入「设置与开发」→「基本配置」
- 记录 `AppID` 和 `AppSecret`

### 2. 配置 IP 白名单
- 在基本配置页面找到「IP 白名单」
- 添加 Coze 服务器 IP 地址
- **Coze 服务器 IP 获取方法**：
  - 在 Coze 插件测试页面查看「网络信息」
  - 或联系 Coze 技术支持获取

### 3. 开通相关权限
确保你的公众号具备以下权限：
- **素材管理权限**：用于上传图片
- **草稿箱功能**：用于创建和管理草稿
- **发布权限**：用于发布文章（如需要）

## 📱 完整使用工作流

### 方式一：直接使用 Coze 插件

1. **在 Coze 工作流中调用插件**
   ```
   输入：标题、内容、封面图片
   ↓
   调用 getAccessToken 获取凭证
   ↓
   调用 uploadImage 上传封面
   ↓
   调用 createDraft 创建草稿
   ↓
   （可选）调用 publishDraft 发布文章
   ```

2. **典型工作流配置**
   - 输入变量：
     - `article_title`: 文章标题
     - `article_content`: 文章内容
     - `cover_image`: 封面图片
     - `wechat_appid`: 微信 AppID
     - `wechat_secret`: 微信 AppSecret

### 方式二：使用自托管前端界面

1. **访问你的 TrendPublish 应用**
   - 打开 `http://localhost:3000`（或你的部署地址）
   - 配置微信 AppID 和 AppSecret
   - 上传封面图片
   - 编写文章内容
   - 点击「保存草稿」或「发布文章」

2. **功能特性**
   - 可视化操作界面
   - 草稿管理功能
   - 批量操作支持
   - 实时状态反馈

## 🛠️ 故障排除

### 常见错误及解决方案

#### 1. `401 Unauthorized`
- **原因**：AppID/Secret 错误或 IP 白名单未配置
- **解决**：
  - 检查 AppID 和 AppSecret 是否正确
  - 确认 IP 白名单包含 Coze 服务器 IP
  - 确认公众号类型正确（服务号才有完整权限）

#### 2. 图片上传失败
- **原因**：图片格式或大小不符合要求
- **解决**：
  - 图片大小不超过 2MB
  - 使用 JPG/PNG 格式
  - 检查图片是否损坏

#### 3. 草稿创建失败
- **原因**：内容格式或参数错误
- **解决**：
  - 检查文章标题不为空
  - 确保 HTML 内容格式正确
  - 确认封面图片已成功上传

#### 4. 发布失败
- **原因**：发布权限不足或草稿问题
- **解决**：
  - 确认公众号有发布权限
  - 检查草稿内容是否符合规范
  - 确认没有违反发布规则

## 📊 性能优化建议

### 1. Access Token 缓存
- Access Token 有效期为 2 小时
- 建议缓存 Token，避免频繁获取

### 2. 图片优化
- 上传前压缩图片
- 使用 WebP 格式（如支持）
- 控制图片尺寸（建议 900x500）

### 3. 内容优化
- 控制文章长度
- 优化 HTML 结构
- 避免使用不支持的标签

## 🔐 安全注意事项

### 1. 凭证安全
- 妥善保管 AppID 和 AppSecret
- 不要在代码中硬编码
- 定期更换 AppSecret

### 2. 权限控制
- 按需申请微信接口权限
- 定期检查授权状态
- 监控异常调用

### 3. 数据安全
- 用户数据加密存储
- 定期备份重要数据
- 遵守数据保护法规

## 📈 扩展功能建议

### 短期扩展（1-2周）
- [ ] 批量文章发布
- [ ] 定时发布功能
- [ ] 文章模板管理
- [ ] 发布历史记录

### 中期扩展（1个月）
- [ ] 多账号管理
- [ ] 数据统计分析
- [ ] 自动回复功能
- [ ] 粉丝互动管理

### 长期扩展（3个月）
- [ ] AI 内容生成
- [ ] 多平台发布
- [ ] 营销自动化
- [ ] 数据可视化

## 📞 技术支持

如遇到问题，可通过以下方式获取帮助：

1. **查看文档**：阅读完整技术文档
2. **检查日志**：查看详细的错误信息
3. **联系支持**：联系技术支持团队
4. **社区交流**：加入用户交流群

---

**版本**: v1.0
**更新日期**: 2025-12-28
**文档状态**: 已完成

## 🎯 立即开始

现在你已经拥有了完整的 Coze 插件创建方案！

**推荐路径**：
1. 🚀 **立即导入** `coze-wechat-openapi.json` 到 Coze
2. 🧪 **快速测试** 验证接口功能
3. 📱 **发布 MCP** 让更多人使用
4. 🔧 **继续开发** 完善高级功能

祝你开发顺利！🎉