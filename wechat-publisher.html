<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ä¿¡æ–‡ç« å‘å¸ƒå·¥å…· - TrendPublish</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: block;
            padding: 12px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-label:hover {
            border-color: #667eea;
            background: #f0f8ff;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .preview-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 200px;
        }
        
        .preview-area h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .preview-content {
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.6;
        }
        
        .status-message {
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 500;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .image-preview {
            max-width: 100px;
            max-height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .config-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .config-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .help-text {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            padding: 8px 16px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quick-action-btn:hover {
            background: #dee2e6;
        }
        
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .quick-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± å¾®ä¿¡æ–‡ç« å‘å¸ƒå·¥å…·</h1>
            <p>ç®€å•æ˜“ç”¨çš„æ–‡ç« å‘å¸ƒå·¥å…·ï¼Œæ”¯æŒä¸€é”®æ¨é€åˆ°å¾®ä¿¡å…¬ä¼—å·è‰ç¨¿ç®±</p>
        </div>
        
        <div class="main-content">
            <!-- é…ç½®åŒºåŸŸ -->
            <div class="config-section">
                <h3>âš™ï¸ å¾®ä¿¡å…¬ä¼—å·é…ç½®</h3>
                <div class="form-group">
                    <label for="appid">AppID:</label>
                    <input type="text" id="appid" placeholder="è¯·è¾“å…¥å¾®ä¿¡å…¬ä¼—å·AppID">
                    <div class="help-text">åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°åå°çš„"å¼€å‘"â†’"åŸºæœ¬é…ç½®"ä¸­è·å–</div>
                </div>
                <div class="form-group">
                    <label for="secret">AppSecret:</label>
                    <input type="password" id="secret" placeholder="è¯·è¾“å…¥å¾®ä¿¡å…¬ä¼—å·AppSecret">
                    <div class="help-text">è¯·å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æ³„éœ²ç»™ä»–äºº</div>
                </div>
                <button class="btn btn-secondary" onclick="saveWechatConfig()">ä¿å­˜é…ç½®</button>
                <button class="btn btn-secondary" onclick="testWechatConfig()">æµ‹è¯•è¿æ¥</button>
                <div id="config-status"></div>
            </div>
            
            <!-- æ ‡ç­¾é¡µ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('manual')">æ‰‹åŠ¨è¾“å…¥</button>
                <button class="tab" onclick="switchTab('url')">URLæå–</button>
                <button class="tab" onclick="switchTab('preview')">é¢„è§ˆå‘å¸ƒ</button>
            </div>
            
            <!-- æ‰‹åŠ¨è¾“å…¥æ ‡ç­¾é¡µ -->
            <div id="manual-tab" class="tab-content active">
                <div class="form-group">
                    <label for="title">æ–‡ç« æ ‡é¢˜:</label>
                    <input type="text" id="title" placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜" maxlength="64">
                    <div class="help-text">å»ºè®®æ ‡é¢˜ç®€æ´æ˜äº†ï¼Œå¸å¼•è¯»è€…æ³¨æ„</div>
                </div>
                
                <div class="form-group">
                    <label for="content">æ–‡ç« å†…å®¹:</label>
                    <textarea id="content" placeholder="è¯·è¾“å…¥æ–‡ç« å†…å®¹ï¼Œæ”¯æŒHTMLæ ¼å¼&#10;æ”¯æŒæ ¼å¼ï¼š&lt;b&gt;åŠ ç²—&lt;/b&gt;ã€&lt;i&gt;æ–œä½“&lt;/i&gt;ã€&lt;p&gt;æ®µè½&lt;/p&gt;ã€&lt;br&gt;æ¢è¡Œç­‰"></textarea>
                    <div class="help-text">æ”¯æŒHTMLæ ¼å¼ï¼Œå¯ä»¥åŒ…å«å›¾ç‰‡ã€é“¾æ¥ç­‰å…ƒç´ </div>
                </div>
                
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="formatContent('bold')">åŠ ç²—</button>
                    <button class="quick-action-btn" onclick="formatContent('italic')">æ–œä½“</button>
                    <button class="quick-action-btn" onclick="formatContent('paragraph')">æ®µè½</button>
                    <button class="quick-action-btn" onclick="formatContent('lineBreak')">æ¢è¡Œ</button>
                    <button class="quick-action-btn" onclick="formatContent('link')">é“¾æ¥</button>
                    <button class="quick-action-btn" onclick="clearContent()">æ¸…ç©ºå†…å®¹</button>
                </div>
                
                <div class="form-group">
                    <label for="summary">æ–‡ç« æ‘˜è¦ï¼ˆå¯é€‰ï¼‰:</label>
                    <textarea id="summary" placeholder="è¯·è¾“å…¥æ–‡ç« æ‘˜è¦ï¼Œä¸å¡«å†™å°†è‡ªåŠ¨ç”Ÿæˆ" rows="3" maxlength="120"></textarea>
                    <div class="help-text">æ˜¾ç¤ºåœ¨æ–‡ç« åˆ—è¡¨ä¸­çš„æ‘˜è¦ï¼Œå»ºè®®120å­—ä»¥å†…</div>
                </div>
                
                <div class="form-group">
                    <label for="author">ä½œè€…ï¼ˆå¯é€‰ï¼‰:</label>
                    <input type="text" id="author" placeholder="è¯·è¾“å…¥ä½œè€…åç§°">
                </div>
            </div>
            
            <!-- URLæå–æ ‡ç­¾é¡µ -->
            <div id="url-tab" class="tab-content">
                <div class="form-group">
                    <label for="article-url">æ–‡ç« URL:</label>
                    <input type="url" id="article-url" placeholder="è¯·è¾“å…¥æ–‡ç« é“¾æ¥ï¼ˆæ”¯æŒå¾®ä¿¡å…¬ä¼—å·æ–‡ç« ã€ç½‘é¡µç­‰ï¼‰">
                    <div class="help-text">è¾“å…¥å¾®ä¿¡å…¬ä¼—å·æ–‡ç« é“¾æ¥æˆ–å…¶ä»–ç½‘é¡µé“¾æ¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æå–å†…å®¹</div>
                </div>
                <button class="btn" onclick="extractArticleContent()">æå–æ–‡ç« å†…å®¹</button>
                <div id="extract-status"></div>
            </div>
            
            <!-- é¢„è§ˆå‘å¸ƒæ ‡ç­¾é¡µ -->
            <div id="preview-tab" class="tab-content">
                <div class="preview-area">
                    <h3>ğŸ“‹ æ–‡ç« é¢„è§ˆ</h3>
                    <div id="preview-title" class="preview-content" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 15px;">æ ‡é¢˜é¢„è§ˆ</div>
                    <div id="preview-content" class="preview-content">å†…å®¹é¢„è§ˆåŒºåŸŸ</div>
                </div>
                
                <div class="form-group" style="margin-top: 30px;">
                    <label for="cover-image">å°é¢å›¾ç‰‡:</label>
                    <div class="file-upload">
                        <input type="file" id="cover-image" accept="image/*" onchange="previewImage(event)">
                        <div class="file-upload-label">
                            ğŸ“· ç‚¹å‡»é€‰æ‹©å°é¢å›¾ç‰‡ï¼ˆå»ºè®®å°ºå¯¸ï¼š900x500åƒç´ ï¼Œå¤§å°ä¸è¶…è¿‡2MBï¼‰
                        </div>
                    </div>
                    <img id="image-preview" class="image-preview" style="display: none;">
                </div>
                
                <button class="btn btn-success" onclick="publishToWechat()">ğŸš€ å‘å¸ƒåˆ°å¾®ä¿¡è‰ç¨¿ç®±</button>
                <button class="btn btn-secondary" onclick="refreshPreview()">ğŸ”„ åˆ·æ–°é¢„è§ˆ</button>
                <button class="btn" onclick="exportAsHtml()">ğŸ“„ å¯¼å‡ºHTML</button>
            </div>
            
            <!-- çŠ¶æ€æ¶ˆæ¯åŒºåŸŸ -->
            <div id="status-message"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentTab = 'manual';
        let wechatConfig = {
            appid: '',
            secret: ''
        };
        let extractedMediaId = '';

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadWechatConfig();
            refreshPreview();
            
            // è‡ªåŠ¨ä¿å­˜è‰ç¨¿
            setInterval(saveDraft, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜
            
            // ç›‘å¬è¾“å…¥å˜åŒ–
            ['title', 'content', 'summary', 'author'].forEach(id => {
                document.getElementById(id).addEventListener('input', refreshPreview);
            });
        });

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ¿€æ´»å½“å‰æ ‡ç­¾é¡µ
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            currentTab = tabName;
            
            // å¦‚æœåˆ‡æ¢åˆ°é¢„è§ˆæ ‡ç­¾é¡µï¼Œåˆ·æ–°é¢„è§ˆ
            if (tabName === 'preview') {
                refreshPreview();
            }
        }

        // ä¿å­˜å¾®ä¿¡é…ç½®
        async function saveWechatConfig() {
            const appid = document.getElementById('appid').value.trim();
            const secret = document.getElementById('secret').value.trim();
            
            if (!appid || !secret) {
                showStatus('è¯·å¡«å†™å®Œæ•´çš„AppIDå’ŒAppSecret', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/wechat/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ appid, secret })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    wechatConfig = { appid, secret };
                    localStorage.setItem('wechatConfig', JSON.stringify(wechatConfig));
                    showStatus('é…ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                } else {
                    showStatus('é…ç½®ä¿å­˜å¤±è´¥ï¼š' + result.error, 'error');
                }
            } catch (error) {
                showStatus('ç½‘ç»œé”™è¯¯ï¼š' + error.message, 'error');
            }
        }

        // æµ‹è¯•å¾®ä¿¡é…ç½®
        async function testWechatConfig() {
            if (!wechatConfig.appid || !wechatConfig.secret) {
                showStatus('è¯·å…ˆä¿å­˜å¾®ä¿¡é…ç½®', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/wechat/token', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('âœ… è¿æ¥æˆåŠŸï¼access_tokenè·å–æ­£å¸¸', 'success');
                } else {
                    showStatus('âŒ è¿æ¥å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (error) {
                showStatus('ç½‘ç»œé”™è¯¯ï¼š' + error.message, 'error');
            }
        }

        // åŠ è½½å¾®ä¿¡é…ç½®
        function loadWechatConfig() {
            const saved = localStorage.getItem('wechatConfig');
            if (saved) {
                wechatConfig = JSON.parse(saved);
                document.getElementById('appid').value = wechatConfig.appid || '';
                document.getElementById('secret').value = wechatConfig.secret || '';
            }
        }

        // æ ¼å¼åŒ–å†…å®¹
        function formatContent(type) {
            const textarea = document.getElementById('content');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let formattedText = '';
            
            switch(type) {
                case 'bold':
                    formattedText = `<b>${selectedText || 'åŠ ç²—æ–‡æœ¬'}</b>`;
                    break;
                case 'italic':
                    formattedText = `<i>${selectedText || 'æ–œä½“æ–‡æœ¬'}</i>`;
                    break;
                case 'paragraph':
                    formattedText = `<p>${selectedText || 'æ®µè½æ–‡æœ¬'}</p>`;
                    break;
                case 'lineBreak':
                    formattedText = selectedText + '<br>';
                    break;
                case 'link':
                    const url = prompt('è¯·è¾“å…¥é“¾æ¥åœ°å€ï¼š');
                    if (url) {
                        formattedText = `<a href="${url}">${selectedText || 'é“¾æ¥æ–‡æœ¬'}</a>`;
                    } else {
                        return;
                    }
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            refreshPreview();
        }

        // æ¸…ç©ºå†…å®¹
        function clearContent() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                document.getElementById('title').value = '';
                document.getElementById('content').value = '';
                document.getElementById('summary').value = '';
                document.getElementById('author').value = '';
                refreshPreview();
            }
        }

        // æå–æ–‡ç« å†…å®¹
        async function extractArticleContent() {
            const url = document.getElementById('article-url').value.trim();
            
            if (!url) {
                showStatus('è¯·è¾“å…¥æ–‡ç« URL', 'error');
                return;
            }
            
            showStatus('æ­£åœ¨æå–æ–‡ç« å†…å®¹...', 'info');
            
            try {
                // è¿™é‡Œå¯ä»¥è°ƒç”¨åç«¯çš„URLæå–API
                // æš‚æ—¶ä½¿ç”¨ç®€å•çš„æ¨¡æ‹Ÿæå–
                setTimeout(() => {
                    document.getElementById('title').value = 'æå–çš„æ ‡é¢˜ç¤ºä¾‹';
                    document.getElementById('content').value = '<p>è¿™æ˜¯ä»URLæå–çš„æ–‡ç« å†…å®¹ç¤ºä¾‹ã€‚</p><p>æ”¯æŒHTMLæ ¼å¼çš„å†…å®¹ã€‚</p>';
                    document.getElementById('summary').value = 'è¿™æ˜¯æ–‡ç« æ‘˜è¦';
                    showStatus('æ–‡ç« å†…å®¹æå–æˆåŠŸï¼', 'success');
                    switchTab('manual');
                    refreshPreview();
                }, 2000);
                
            } catch (error) {
                showStatus('æå–å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // é¢„è§ˆå›¾ç‰‡
        function previewImage(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('image-preview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // åˆ·æ–°é¢„è§ˆ
        function refreshPreview() {
            const title = document.getElementById('title').value || 'æ ‡é¢˜é¢„è§ˆ';
            const content = document.getElementById('content').value || 'å†…å®¹é¢„è§ˆåŒºåŸŸ';
            const author = document.getElementById('author').value;
            
            document.getElementById('preview-title').textContent = title;
            document.getElementById('preview-content').innerHTML = content;
            
            if (author) {
                document.getElementById('preview-title').textContent += ' - ' + author;
            }
        }

        // å‘å¸ƒåˆ°å¾®ä¿¡
        async function publishToWechat() {
            if (!wechatConfig.appid || !wechatConfig.secret) {
                showStatus('è¯·å…ˆé…ç½®å¾®ä¿¡AppIDå’ŒAppSecret', 'error');
                return;
            }
            
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            const summary = document.getElementById('summary').value.trim();
            const author = document.getElementById('author').value.trim();
            const coverImage = document.getElementById('cover-image').files[0];
            
            if (!title || !content) {
                showStatus('è¯·å¡«å†™æ–‡ç« æ ‡é¢˜å’Œå†…å®¹', 'error');
                return;
            }
            
            showStatus('æ­£åœ¨å‘å¸ƒåˆ°å¾®ä¿¡è‰ç¨¿ç®±...', 'info');
            
            try {
                let thumbMediaId = '';
                
                // å¦‚æœæœ‰å°é¢å›¾ç‰‡ï¼Œå…ˆä¸Šä¼ å›¾ç‰‡
                if (coverImage) {
                    const formData = new FormData();
                    formData.append('media', coverImage);
                    
                    const uploadResponse = await fetch('/api/wechat/upload-image', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const uploadResult = await uploadResponse.json();
                    
                    if (uploadResult.success) {
                        // è¿™é‡Œéœ€è¦è·å–å®é™…çš„media_idï¼Œæš‚æ—¶ä½¿ç”¨URL
                        thumbMediaId = uploadResult.url;
                    } else {
                        showStatus('å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼š' + uploadResult.error, 'error');
                        return;
                    }
                }
                
                // å‘å¸ƒæ–‡ç« 
                const publishResponse = await fetch('/api/wechat/publish', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title,
                        content,
                        summary,
                        author,
                        thumb_media_id: thumbMediaId
                    })
                });
                
                const publishResult = await publishResponse.json();
                
                if (publishResult.success) {
                    showStatus(`ğŸ‰ å‘å¸ƒæˆåŠŸï¼åª’ä½“ID: ${publishResult.media_id}`, 'success');
                    // æ¸…ç©ºè¡¨å•
                    clearContent();
                } else {
                    showStatus('å‘å¸ƒå¤±è´¥ï¼š' + publishResult.error, 'error');
                }
                
            } catch (error) {
                showStatus('å‘å¸ƒå¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // å¯¼å‡ºHTML
        function exportAsHtml() {
            const title = document.getElementById('title').value || 'æœªå‘½åæ–‡ç« ';
            const content = document.getElementById('content').value || '';
            const author = document.getElementById('author').value;
            
            const html = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${title}</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .author { color: #666; font-style: italic; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>${title}</h1>
    ${author ? `<div class="author">ä½œè€…ï¼š${author}</div>` : ''}
    <div class="content">${content}</div>
</body>
</html>`;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = title + '.html';
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('HTMLæ–‡ä»¶å·²å¯¼å‡º', 'success');
        }

        // ä¿å­˜è‰ç¨¿åˆ°æœ¬åœ°å­˜å‚¨
        function saveDraft() {
            const draft = {
                title: document.getElementById('title').value,
                content: document.getElementById('content').value,
                summary: document.getElementById('summary').value,
                author: document.getElementById('author').value,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('articleDraft', JSON.stringify(draft));
        }

        // åŠ è½½è‰ç¨¿
        function loadDraft() {
            const saved = localStorage.getItem('articleDraft');
            if (saved) {
                const draft = JSON.parse(saved);
                document.getElementById('title').value = draft.title || '';
                document.getElementById('content').value = draft.content || '';
                document.getElementById('summary').value = draft.summary || '';
                document.getElementById('author').value = draft.author || '';
                refreshPreview();
                
                showStatus(`å·²åŠ è½½ ${new Date(draft.timestamp).toLocaleString()} çš„è‰ç¨¿`, 'info');
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.className = 'status-message status-' + type;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            // 5ç§’åè‡ªåŠ¨éšè—æˆåŠŸå’Œä¿¡æ¯æ¶ˆæ¯
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }
    </script>
</body>
</html>