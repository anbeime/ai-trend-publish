# ğŸš€ AIçƒ­ç‚¹è‡ªåŠ¨å‘å¸ƒ - 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

## âœ… æ‚¨å·²æ‹¥æœ‰çš„ç»„ä»¶

æ‰€æœ‰ä»£ç å·²å®Œæˆï¼Œä½äº `C:\D\ai-trend-publish`ï¼š

```
ğŸ“ ai-trend-publish/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ hot-news.js          âœ… çƒ­ç‚¹é‡‡é›† API
â”‚   â”œâ”€â”€ format-wechat.js     âœ… æ’ç‰ˆä¼˜åŒ– API
â”‚   â””â”€â”€ index.js             âœ… å¾®ä¿¡å‘å¸ƒ APIï¼ˆç°æœ‰ï¼‰
â”œâ”€â”€ n8n-auto-publish-workflow.json  âœ… N8N å·¥ä½œæµé…ç½®
â”œâ”€â”€ create-schedule-tasks.bat       âœ… Windows å®šæ—¶ä»»åŠ¡åˆ›å»ºå·¥å…·
â”œâ”€â”€ test_auto_publish.py            âœ… æµ‹è¯•è„šæœ¬
â””â”€â”€ README_AUTO_PUBLISH.md          âœ… å®Œæ•´æ–‡æ¡£
```

---

## ğŸ¯ éƒ¨ç½²æ–¹æ¡ˆï¼ˆæ¨èï¼‰

ç”±äºæµ‹è¯•ç¯å¢ƒæœ‰ç½‘ç»œä»£ç†ï¼Œæ¨èä½¿ç”¨ **N8N å†…ç½®å®šæ—¶è§¦å‘å™¨** è€Œéå¤–éƒ¨ Windows ä»»åŠ¡ã€‚

### æ–¹æ¡ˆA: N8N å®šæ—¶è§¦å‘ï¼ˆæ¨è â­ï¼‰

#### æ­¥éª¤ 1: éƒ¨ç½²çƒ­ç‚¹é‡‡é›†åˆ° Cloudflare Workers

çƒ­ç‚¹é‡‡é›†ä¸éœ€è¦å¤æ‚ç¯å¢ƒï¼Œç›´æ¥éƒ¨ç½²åˆ° Cloudflareï¼š

1. **å‡†å¤‡æ–‡ä»¶**
   ```javascript
   // _worker.js
   import { handleRequest } from './api/hot-news.js';
   export default { fetch: handleRequest };
   ```

2. **éƒ¨ç½²å‘½ä»¤**
   ```bash
   cd C:\D\ai-trend-publish
   wrangler deploy
   ```

3. **è·å– URL**
   ```
   https://ai-trend-publish.YOUR_SUBDOMAIN.workers.dev/api/hot-news
   ```

---

#### æ­¥éª¤ 2: å¯¼å…¥ N8N å·¥ä½œæµ

1. æ‰“å¼€ N8N: `http://localhost:5678`

2. ç‚¹å‡» **Import** â†’ é€‰æ‹© `n8n-auto-publish-workflow.json`

3. **ä¿®æ”¹é‡‡é›† API URL** ï¼ˆèŠ‚ç‚¹: "é‡‡é›†çƒ­ç‚¹æ–‡ç« "ï¼‰ï¼š
   ```javascript
   url: "https://ai-trend-publish.YOUR_SUBDOMAIN.workers.dev/api/hot-news"
   ```

4. **è¿æ¥æ‚¨çš„ COZE èŠ‚ç‚¹**ï¼š
   - åˆ é™¤å ä½ç¬¦èŠ‚ç‚¹
   - æ’å…¥æ‚¨ç°æœ‰çš„ COZE æ”¹å†™å·¥ä½œæµ
   - ç¡®ä¿è¾“å‡ºæ ¼å¼ï¼š`{title, content, images}`

5. **é…ç½®å¾®ä¿¡å‘å¸ƒ**ï¼ˆèŠ‚ç‚¹: "å‘å¸ƒåˆ°å¾®ä¿¡è‰ç¨¿ç®±"ï¼‰ï¼š
   - å¦‚æœéƒ¨ç½²åˆ° Vercelï¼Œä¿®æ”¹ URL
   - å¦‚æœæœ¬åœ°è¿è¡Œï¼Œä¿æŒ `localhost:3000`

---

#### æ­¥éª¤ 3: æ¿€æ´»è‡ªåŠ¨è§¦å‘

å·¥ä½œæµå·²é¢„é…ç½®å®šæ—¶è§¦å‘ï¼š
- **Cron**: `30 8,20,22 * * *`
- **æ—¶é—´**: 08:30, 20:00, 22:00

ç‚¹å‡»å·¥ä½œæµå³ä¸Šè§’çš„ **"Activate"** æŒ‰é’®å³å¯ï¼

---

### æ–¹æ¡ˆB: Windows å®šæ—¶ä»»åŠ¡ + Webhook

å¦‚æœå¸Œæœ›ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡æ§åˆ¶ï¼š

#### æ­¥éª¤ 1: åœ¨ N8N ä¸­æ·»åŠ  Webhook è§¦å‘å™¨

1. åˆ é™¤ "å®šæ—¶è§¦å‘" èŠ‚ç‚¹
2. æ·»åŠ  **Webhook** èŠ‚ç‚¹
3. è®¾ç½®è·¯å¾„: `/auto-publish-trigger`
4. è·å– Webhook URL: `http://localhost:5678/webhook/auto-publish-trigger`

---

#### æ­¥éª¤ 2: åˆ›å»º Windows å®šæ—¶ä»»åŠ¡

ä»¥**ç®¡ç†å‘˜èº«ä»½**è¿è¡Œï¼š
```bash
C:\D\ai-trend-publish\create-schedule-tasks.bat
```

è¿™ä¼šåˆ›å»º 3 ä¸ªå®šæ—¶ä»»åŠ¡ï¼š
- æ—©æ™¨ 08:30
- æ™šé—´ 20:00
- ç¡å‰ 22:00

**éªŒè¯ä»»åŠ¡**ï¼š
```bash
schtasks /Query /TN "AIçƒ­ç‚¹å‘å¸ƒ*"
```

---

## ğŸ§ª æµ‹è¯•å®Œæ•´æµç¨‹

### æ–¹å¼1: N8N æ‰‹åŠ¨æ‰§è¡Œ

1. æ‰“å¼€å·¥ä½œæµ
2. ç‚¹å‡» **"Execute Workflow"**
3. è§‚å¯Ÿæ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œç»“æœ
4. æ£€æŸ¥å¾®ä¿¡è‰ç¨¿ç®±

---

### æ–¹å¼2: æ‰‹åŠ¨è§¦å‘å®šæ—¶ä»»åŠ¡

```bash
schtasks /Run /TN "AIçƒ­ç‚¹å‘å¸ƒ-æ—©æ™¨"
```

---

### æ–¹å¼3: ç›´æ¥æµ‹è¯• API

```bash
# æµ‹è¯•çƒ­ç‚¹é‡‡é›†ï¼ˆCloudflare Workersï¼‰
curl "https://ai-trend-publish.YOUR_SUBDOMAIN.workers.dev/api/hot-news?limit=3"

# æˆ–ä½¿ç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®
```

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. æŸ¥çœ‹ N8N æ‰§è¡Œå†å²

- æ‰“å¼€å·¥ä½œæµ â†’ ç‚¹å‡» **"Executions"**
- æŸ¥çœ‹æˆåŠŸ/å¤±è´¥è®°å½•
- ç‚¹å‡»å•æ¡è®°å½•æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

---

### 2. æ£€æŸ¥ Windows ä»»åŠ¡æ—¥å¿—

```bash
# æŸ¥çœ‹ä»»åŠ¡å†å²
Get-ScheduledTaskInfo -TaskName "AIçƒ­ç‚¹å‘å¸ƒ-æ—©æ™¨"
```

---

### 3. å¾®ä¿¡å‘å¸ƒç»Ÿè®¡

æ¯å¤©æ£€æŸ¥å¾®ä¿¡å…¬ä¼—å·è‰ç¨¿ç®±ï¼š
- é¢„æœŸï¼šæ¯å¤© 9 ç¯‡æ–‡ç« ï¼ˆ3æ¬¡ Ã— 3ç¯‡ï¼‰
- äººå·¥å®¡æ ¸åå‘å¸ƒ 2-3 ç¯‡ç²¾å“

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### è‡ªåŠ¨åŒ–æµç¨‹

```
08:30 è§¦å‘ â†’ é‡‡é›†10ç¯‡ â†’ ç­›é€‰TOP3 â†’ COZEæ”¹å†™ â†’ æ’ç‰ˆ â†’ è‰ç¨¿ç®±
20:00 è§¦å‘ â†’ é‡‡é›†10ç¯‡ â†’ ç­›é€‰TOP3 â†’ COZEæ”¹å†™ â†’ æ’ç‰ˆ â†’ è‰ç¨¿ç®±
22:00 è§¦å‘ â†’ é‡‡é›†10ç¯‡ â†’ ç­›é€‰TOP3 â†’ COZEæ”¹å†™ â†’ æ’ç‰ˆ â†’ è‰ç¨¿ç®±
```

### æ¯æ—¥äº§å‡º

- **è‡ªåŠ¨å…¥åº“**: 9 ç¯‡è‰ç¨¿
- **äººå·¥ç­›é€‰**: 2-3 ç¯‡å‘å¸ƒ
- **æ€»è€—æ—¶**: æ¯æ¬¡çº¦ 3-5 åˆ†é’Ÿï¼ˆè‡ªåŠ¨ï¼‰
- **äººå·¥æ—¶é—´**: ä»…éœ€å®¡æ ¸ 5-10 åˆ†é’Ÿ/å¤©

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: Cloudflare Workers éƒ¨ç½²å¤±è´¥

```bash
# æ£€æŸ¥ wrangler ç‰ˆæœ¬
wrangler --version

# é‡æ–°ç™»å½•
wrangler login

# æŸ¥çœ‹æ—¥å¿—
wrangler tail
```

---

### é—®é¢˜2: N8N å·¥ä½œæµæ‰§è¡Œå¤±è´¥

**æ£€æŸ¥é¡¹**:
1. COZE èŠ‚ç‚¹æ˜¯å¦æ­£ç¡®è¿æ¥
2. çƒ­ç‚¹é‡‡é›† API æ˜¯å¦å¯è®¿é—®
3. å¾®ä¿¡ AppID/AppSecret æ˜¯å¦æ­£ç¡®
4. IP ç™½åå•æ˜¯å¦åŒ…å«æœåŠ¡å™¨ IP

**å¿«é€Ÿè¯Šæ–­**:
```bash
# æµ‹è¯•é‡‡é›† API
curl "https://your-workers.dev/api/hot-news?limit=1"

# æµ‹è¯•å¾®ä¿¡ Access Token
curl "https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=wx8410119dfbb7f756&secret=3c93e33e087e57b906f5c341aa5223b9"
```

---

### é—®é¢˜3: Windows ä»»åŠ¡ä¸æ‰§è¡Œ

```bash
# æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
schtasks /Query /TN "AIçƒ­ç‚¹å‘å¸ƒ-æ—©æ™¨" /V

# æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
schtasks /Run /TN "AIçƒ­ç‚¹å‘å¸ƒ-æ—©æ™¨"

# æŸ¥çœ‹ä»»åŠ¡å†å²
Get-WinEvent -LogName "Microsoft-Windows-TaskScheduler/Operational" | Where-Object {$_.TaskCategory -eq "Task Scheduler launched action"}
```

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### 1. å¢åŠ å»é‡æ£€æŸ¥

åœ¨å‘å¸ƒå‰æ£€æŸ¥æ˜¯å¦å·²å‘è¿‡ç›¸åŒæ ‡é¢˜ï¼š
```javascript
// åœ¨ N8N Code èŠ‚ç‚¹ä¸­
const publishedTitles = await getRecentTitles(); // ä»æ•°æ®åº“/æ–‡ä»¶è·å–
if (publishedTitles.includes(article.title)) {
  return null; // è·³è¿‡é‡å¤æ–‡ç« 
}
```

---

### 2. æ·»åŠ å¤±è´¥é€šçŸ¥

å‘é€é’‰é’‰/ä¼ä¸šå¾®ä¿¡é€šçŸ¥ï¼š
```javascript
// æ·»åŠ  HTTP Request èŠ‚ç‚¹
{
  "url": "https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN",
  "method": "POST",
  "body": {
    "msgtype": "text",
    "text": {
      "content": "âŒ çƒ­ç‚¹å‘å¸ƒå¤±è´¥: {{ $json.error }}"
    }
  }
}
```

---

### 3. æ™ºèƒ½å‘å¸ƒæ—¶é—´

æ ¹æ®å†å²æ•°æ®åˆ†ææœ€ä½³å‘å¸ƒæ—¶é—´ï¼š
- ç»Ÿè®¡æ¯ä¸ªæ—¶æ®µçš„é˜…è¯»é‡
- åŠ¨æ€è°ƒæ•´å‘å¸ƒæ—¶é—´
- A/B æµ‹è¯•ä¸åŒæ ‡é¢˜

---

## ğŸ“ é‡è¦æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” | ä½ç½® |
|------|------|------|
| **n8n-auto-publish-workflow.json** | N8N å·¥ä½œæµé…ç½®ï¼Œç›´æ¥å¯¼å…¥ | é¡¹ç›®æ ¹ç›®å½• |
| **api/hot-news.js** | çƒ­ç‚¹é‡‡é›†é€»è¾‘ï¼Œéƒ¨ç½²åˆ° Workers | api/ |
| **api/format-wechat.js** | æ’ç‰ˆä¼˜åŒ–é€»è¾‘ | api/ |
| **create-schedule-tasks.bat** | Windows å®šæ—¶ä»»åŠ¡åˆ›å»ºå·¥å…· | é¡¹ç›®æ ¹ç›®å½• |
| **README_AUTO_PUBLISH.md** | å®Œæ•´æŠ€æœ¯æ–‡æ¡£ | é¡¹ç›®æ ¹ç›®å½• |

---

## ğŸ‰ å®Œæˆåæ£€æŸ¥æ¸…å•

- [ ] Cloudflare Workers å·²éƒ¨ç½²çƒ­ç‚¹é‡‡é›† API
- [ ] N8N å·¥ä½œæµå·²å¯¼å…¥å¹¶è¿æ¥ COZE èŠ‚ç‚¹
- [ ] å®šæ—¶è§¦å‘å™¨å·²é…ç½®ï¼ˆN8N å†…ç½®æˆ– Windows ä»»åŠ¡ï¼‰
- [ ] æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•æˆåŠŸï¼Œè‰ç¨¿ç®±æœ‰æ–‡ç« 
- [ ] å·²æ¿€æ´»å·¥ä½œæµï¼Œç­‰å¾…è‡ªåŠ¨è§¦å‘

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- **æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£**: `README_AUTO_PUBLISH.md`
- **æŠ€æœ¯æŒ‡å—**: `N8N_AUTO_WORKFLOW_GUIDE.md`
- **æ£€æŸ¥ N8N æ—¥å¿—**: å·¥ä½œæµ â†’ Executions
- **æ£€æŸ¥å¾®ä¿¡ API**: å…¬ä¼—å·åå° â†’ å¼€å‘ â†’ æ¥å£è°ƒè¯•å·¥å…·

---

**åˆ›å»ºæ—¶é—´**: 2026-01-04
**ç³»ç»ŸçŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
**ä¸‹æ¬¡æ›´æ–°**: æ ¹æ®ä½¿ç”¨åé¦ˆä¼˜åŒ–
